<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PYH Product Code Request</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Kanit', 'Inter', sans-serif; }
    ::-webkit-scrollbar { width: 0px; background: transparent; }
    .pyh-gradient { background: linear-gradient(135deg, #10B981, #06B6D4); }
    .pyh-gradient-text { background: linear-gradient(135deg, #10B981, #06B6D4); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
    .page { display: none; }
    .btn-icon-no-pointer { pointer-events: none; }
    .manager-plus-item-cell { display: none; }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">

  <a href="index.html" class="fixed top-4 left-4 z-50 bg-gray-800 text-white px-3 py-2 rounded-full text-xs hover:bg-gray-700 shadow-lg flex items-center transition-all">
    <i data-feather="arrow-left" class="w-3 h-3 mr-1"></i> Back to Portal
  </a>

  <div id="login-page" class="page flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-8 overflow-hidden">
      <div class="text-center mb-8">
        <h1 class="text-5xl font-bold pyh-gradient-text">PYH</h1>
        <p class="text-gray-500 mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
      </div>
      <form id="login-form" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
          <div class="mt-1 relative rounded-md shadow-sm">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i data-feather="user" class="w-5 h-5 text-gray-400"></i></div>
            <input type="text" id="username" class="focus:ring-cyan-500 focus:border-cyan-500 block w-full pl-10 pr-4 sm:text-sm border-gray-300 rounded-lg h-12" placeholder="‡πÄ‡∏ä‡πà‡∏ô admin ‡∏´‡∏£‡∏∑‡∏≠ IT">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <div class="mt-1 relative rounded-md shadow-sm">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i data-feather="lock" class="w-5 h-5 text-gray-400"></i></div>
            <input type="password" id="password" class="focus:ring-cyan-500 focus:border-cyan-500 block w-full pl-10 pr-4 sm:text-sm border-gray-300 rounded-lg h-12" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
        </div>
        <div id="login-error-msg" class="text-red-600 text-sm text-center"></div>
        <div>
          <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white pyh-gradient hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </form>
    </div>
  </div>

  <div id="main-app" class="page min-h-screen">
    <header class="bg-white shadow-md sticky top-0 z-50">
      <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center space-x-8">
            <div class="flex-shrink-0"><span class="text-3xl font-bold pyh-gradient-text">PYH</span></div>
            <div class="hidden md:flex space-x-4">
              <a href="#" class="nav-link text-gray-700 hover:text-cyan-600 px-3 py-2 rounded-md text-sm font-medium" data-page="home">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
              <a href="#" class="nav-link text-gray-700 hover:text-cyan-600 px-3 py-2 rounded-md text-sm font-medium" data-page="history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</a>
              <a href="#" id="nav-settings" class="nav-link text-gray-700 hover:text-cyan-600 px-3 py-2 rounded-md text-sm font-medium admin-only-item" data-page="settings" style="display:none;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Admin)</a>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <div class="text-right">
              <div id="user-info-name" class="text-sm font-medium text-gray-800"></div>
              <div id="user-info-dept" class="text-xs text-gray-500"></div>
            </div>
            <button id="logout-button" class="p-2 rounded-full text-gray-500 hover:text-cyan-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-cyan-500"><i data-feather="log-out" class="w-5 h-5"></i></button>
          </div>
        </div>
      </nav>
    </header>

    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
      <div id="app-page-home" class="app-page px-4">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 max-w-3xl mx-auto">
          <h2 class="text-2xl font-semibold text-gray-900 mb-6">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
          <form id="request-form" class="space-y-5">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div><label class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏´‡∏±‡∏™</label><input type="date" id="req-date" class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3"></div>
              <div><label class="block text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</label><input type="text" id="req-department" readonly class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3 bg-gray-100 text-gray-500"></div>
            </div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©) *</label><input type="text" id="req-product-name" required class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div><label class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label><select id="req-product-type" required class="mt-1 block w-full border-gray-300 bg-white rounded-md h-11 px-3"></select></div>
              <div><label class="block text-sm font-medium text-gray-700">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö *</label><select id="req-unit" required class="mt-1 block w-full border-gray-300 bg-white rounded-md h-11 px-3"></select></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div><label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏´‡∏±‡∏™ *</label><input type="text" id="req-requester-name" required class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3"></div>
              <div><label class="block text-sm font-medium text-gray-700">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label><input type="text" id="req-position" required class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3"></div>
            </div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><p class="mt-1 text-gray-500 bg-gray-100 rounded-md h-11 px-3 py-2.5 sm:text-sm">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p></div>
            <div>
              <label class="block text-sm font-medium text-gray-700">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
              <input type="file" id="req-image" class="hidden" accept="image/*">
              <div class="mt-1 flex items-center">
                <label for="req-image" class="cursor-pointer rounded-md border-0 bg-cyan-50 px-4 py-2 text-sm font-semibold text-cyan-700 hover:bg-cyan-100">Choose File</label>
                <span id="file-name-display" class="ml-3 text-sm text-gray-500">No file chosen</span>
              </div>
              <div class="mt-4"><img id="req-image-preview" src="#" class="hidden w-full max-w-xs rounded-lg shadow-md border" /></div>
            </div>
            <div class="pt-5 text-right">
              <button type="submit" class="inline-flex justify-center py-2.5 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"><i data-feather="save" class="w-5 h-5 mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
            </div>
          </form>
        </div>
      </div>

      <div id="app-page-history" class="app-page px-4">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
          <h2 id="history-title" class="text-2xl font-semibold text-gray-900 mb-6">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</h2>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div id="filter-dept-container" class="manager-plus-item" style="display:none;">
              <label class="block text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</label>
              <select id="filter-dept" class="mt-1 block w-full border-gray-300 bg-white rounded-md h-11 px-3"><option value="all">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select>
            </div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="filter-status" class="mt-1 block w-full border-gray-300 bg-white rounded-md h-11 px-3"><option value="all">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select></div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)</label><input type="date" id="filter-date-start" class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3"></div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)</label><input type="date" id="filter-date-end" class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3"></div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div><label class="block text-sm font-medium text-gray-700">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" id="filter-search" class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."></div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" id="filter-search-code" class="mt-1 block w-full border-gray-300 rounded-md h-11 px-3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."></div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase manager-plus-item-cell">‡πÅ‡∏ú‡∏ô‡∏Å</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                  <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
              </thead>
              <tbody id="history-table-body" class="bg-white divide-y divide-gray-200"></tbody>
            </table>
            <div id="history-no-data" class="text-center py-12 text-gray-500 hidden">
              <i data-feather="inbox" class="w-16 h-16 mx-auto mb-4"></i><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>
            </div>
          </div>
        </div>
      </div>
      
      <div id="app-page-settings" class="app-page px-4">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Admin)</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          
          <div class="md:col-span-2 bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <form id="add-user-form" class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-3 mb-4 p-4 border rounded-lg bg-gray-50">
              <input type="text" id="new-user-username" placeholder="Username" class="sm:text-sm border-gray-300 rounded-md" required>
              <input type="password" id="new-user-password" placeholder="Password" class="sm:text-sm border-gray-300 rounded-md" required>
              <select id="new-user-role" class="sm:text-sm border-gray-300 rounded-md" required>
                <option value="user">User</option>
                <option value="manager">Manager</option>
                <option value="admin">Admin</option>
              </select>
              <input type="text" id="new-user-dept" placeholder="Department" class="sm:text-sm border-gray-300 rounded-md" required>
              <button type="submit" class="sm:col-span-1 md:col-span-1 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-md text-sm px-4 py-2 flex items-center justify-center">
                <i data-feather="plus" class="w-4 h-4 mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
              </button>
            </form>
            <div class="overflow-y-auto max-h-96">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Department</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
                  </tr>
                </thead>
                <tbody id="settings-user-table-body" class="bg-white divide-y divide-gray-200"></tbody>
              </table>
            </div>
          </div>

          <div class="md:col-span-1 space-y-6">
            
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-medium text-gray-900 mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö"</h3>
              <form id="setting-unit-form" class="flex gap-2 mb-3">
                <input type="text" id="new-unit-value" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà" class="flex-grow sm:text-sm border-gray-300 rounded-md" required>
                <button type="submit" class="text-white bg-blue-600 hover:bg-blue-700 rounded-md px-3 py-2"><i data-feather="plus" class="w-5 h-5"></i></button>
              </form>
              <ul id="settings-unit-list" class="space-y-2 max-h-40 overflow-y-auto"></ul>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-medium text-gray-900 mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"</h3>
              <form id="setting-product-type-form" class="flex gap-2 mb-3">
                <input type="text" id="new-product-type-value" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏´‡∏°‡πà" class="flex-grow sm:text-sm border-gray-300 rounded-md" required>
                <button type="submit" class="text-white bg-blue-600 hover:bg-blue-700 rounded-md px-3 py-2"><i data-feather="plus" class="w-5 h-5"></i></button>
              </form>
              <ul id="settings-product-type-list" class="space-y-2 max-h-40 overflow-y-auto"></ul>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-medium text-gray-900 mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"</h3>
              <form id="setting-status-form" class="flex gap-2 mb-3">
                <input type="text" id="new-status-value" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà" class="flex-grow sm:text-sm border-gray-300 rounded-md" required>
                <button type="submit" class="text-white bg-blue-600 hover:bg-blue-700 rounded-md px-3 py-2"><i data-feather="plus" class="w-5 h-5"></i></button>
              </form>
              <ul id="settings-status-list" class="space-y-2 max-h-40 overflow-y-auto"></ul>
            </div>

          </div>
        </div>
      </div>
    </main>
  </div>

  <div id="request-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black bg-opacity-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
      <form id="modal-form">
        <div class="p-6 md:p-8">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold text-gray-900">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠</h2>
            <button type="button" class="modal-close-btn text-gray-400 hover:text-gray-600"><i data-feather="x" class="w-6 h-6"></i></button>
          </div>
          <div class="space-y-5">
            <input type="hidden" id="modal-request-id">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div><label class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠</label><input type="date" id="modal-date" class="modal-field mt-1 w-full border-gray-300 rounded-md h-11 px-3"></div>
              <div><label class="block text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</label><input type="text" id="modal-department" readonly class="modal-field bg-gray-100 mt-1 w-full border-gray-300 rounded-md h-11 px-3"></div>
            </div>
            <div><label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" id="modal-product-name" class="modal-field mt-1 w-full border-gray-300 rounded-md h-11 px-3"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div><label class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select id="modal-product-type" class="modal-field mt-1 w-full border-gray-300 bg-white rounded-md h-11 px-3"></select></div>
              <div><label class="block text-sm font-medium text-gray-700">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö</label><select id="modal-unit" class="modal-field mt-1 w-full border-gray-300 bg-white rounded-md h-11 px-3"></select></div>
            </div>
            <div class="space-y-5 pt-5 border-t border-gray-200 manager-plus-item" style="display:none;">
                <h3 class="text-lg font-medium text-gray-900">‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Admin</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div><label class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" id="modal-product-code" class="modal-field admin-field mt-1 w-full border-gray-300 rounded-md h-11 px-3"></div>
                    <div><label class="block text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="modal-status" class="modal-field admin-field mt-1 w-full border-gray-300 bg-white rounded-md h-11 px-3"></select></div>
                </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-6 py-4 flex justify-end space-x-3">
            <button type="button" class="modal-close-btn bg-white py-2 px-4 border border-gray-300 rounded-md">‡∏õ‡∏¥‡∏î</button>
            <button type="submit" id="modal-save-button" class="bg-blue-600 text-white py-2 px-4 rounded-md" style="display:none;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ==========================================
    // üî¥ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ! (Request API)
    // ==========================================
    // üëáüëáüëá ‡πÄ‡∏≠‡∏≤ URL ‡∏à‡∏≤‡∏Å Google Apps Script (Request) ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üëáüëáüëá
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwOlZCB0dyO_QXjFcOUGeFCS3uYqlqF6pNCCVcUdGnTgs2dU22GNuEpTKwVabVFPoRW/exec"; 

    const google = {
      script: {
        run: {
          withSuccessHandler: function(cb) { this._cb = cb; return this; },
          withFailureHandler: function(fb) { this._fb = fb; return this; },
          _call: function(act, args) {
            fetch(SCRIPT_URL, {
              method: 'POST',
              headers: { "Content-Type": "text/plain;charset=utf-8" },
              body: JSON.stringify({ action: act, args: args })
            })
            .then(r => r.json())
            .then(d => { 
                if(d.success === false && this._fb) this._fb(d.message);
                else if(this._cb) this._cb(d); 
            })
            .catch(e => { console.error(e); if(this._fb) this._fb(e); });
          },
          checkLogin: function(...a) { this._call('checkLogin', a); },
          getInitialData: function(...a) { this._call('getInitialData', a); },
          submitRequest: function(...a) { this._call('submitRequest', a); },
          updateRequest: function(...a) { this._call('updateRequest', a); },
          deleteRequest: function(...a) { this._call('deleteRequest', a); },
        }
      }
    };

    const STATE = { loggedInUser: null, isPrivilegedUser: false, requests: [], settings: { units: [], statuses: [], productTypes: [] } };
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);

    // Utility
    function showLoading(t) { Swal.fire({ title: t, allowOutsideClick: false, didOpen: () => Swal.showLoading() }); }
    function hideLoading() { Swal.close(); }
    function showError(m) { Swal.fire('Error', m, 'error'); }
    function formatDate(d) { if(!d) return ''; const date = new Date(d); return date.toISOString().split('T')[0]; }

    // Login
    $('#login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        showLoading('Checking...');
        google.script.run
            .withSuccessHandler((res) => {
                if(res.success) {
                    STATE.loggedInUser = res.user;
                    STATE.isPrivilegedUser = ['admin', 'manager'].includes(res.user.role);
                    sessionStorage.setItem('pyh_user', JSON.stringify(res.user));
                    google.script.run.withSuccessHandler(initData).getInitialData(res.user);
                } else {
                    hideLoading();
                    $('#login-error-msg').textContent = res.message;
                }
            })
            .withFailureHandler((err) => { hideLoading(); showError(err); })
            .checkLogin($('#username').value, $('#password').value);
    });

    // Init Data
    function initData(res) {
        hideLoading();
        if(res.success) {
            // ‚úÖ ‡∏Å‡∏±‡∏ô Error ‡∏à‡∏≠‡πÅ‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
            STATE.requests = Array.isArray(res.requests) ? res.requests : []; 
            STATE.settings = res.settings || {};
            
            // Setup UI
            $('#login-page').style.display = 'none';
            $('#main-app').style.display = 'block';
            $('#user-info-name').textContent = STATE.loggedInUser.username;
            $$('.admin-only-item').forEach(el => el.style.display = STATE.loggedInUser.role === 'admin' ? '' : 'none');
            
            // Populate Dropdowns
            const populate = (id, list) => {
                const el = $(id); el.innerHTML = '';
                (list || []).forEach(i => el.innerHTML += `<option value="${i}">${i}</option>`);
            };
            populate('#req-unit', STATE.settings.units);
            populate('#req-product-type', STATE.settings.productTypes);
            populate('#modal-unit', STATE.settings.units);
            populate('#modal-product-type', STATE.settings.productTypes);
            populate('#modal-status', STATE.settings.statuses);

            renderHistoryPage();
        }
    }

    // ‚úÖ Function ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß: Render History
    function renderHistoryPage() {
        const tbody = $('#history-table-body');
        tbody.innerHTML = '';
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ä‡πâ STATE.requests ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ Array ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß)
        const data = STATE.requests; 

        if (data.length === 0) {
            $('#history-no-data').style.display = 'block';
            return;
        }
        $('#history-no-data').style.display = 'none';

        data.forEach(req => {
            const row = `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm text-gray-700">${formatDate(req.RequestDate)}</td>
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${req.ProductName}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 manager-plus-item-cell">${req.Department}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${req.ProductCode || '-'}</td>
                    <td class="px-6 py-4 text-sm">${req.Status}</td>
                    <td class="px-6 py-4 text-center">
                        <button class="text-blue-600 hover:text-blue-900" onclick="openModal('${req.RequestID}')">View</button>
                    </td>
                </tr>`;
            tbody.innerHTML += row;
        });
        feather.replace();
    }
    
    // Navigation
    $$('.nav-link').forEach(l => l.addEventListener('click', (e) => {
        e.preventDefault();
        $$('.app-page').forEach(p => p.style.display = 'none');
        const page = e.target.dataset.page;
        $(`#app-page-${page}`).style.display = 'block';
        if(page === 'history') renderHistoryPage();
    }));

    // Start
    if(sessionStorage.getItem('pyh_user')) {
        STATE.loggedInUser = JSON.parse(sessionStorage.getItem('pyh_user'));
        STATE.isPrivilegedUser = ['admin', 'manager'].includes(STATE.loggedInUser.role);
        google.script.run.withSuccessHandler(initData).getInitialData(STATE.loggedInUser);
    }
    feather.replace();
  </script>
</body>
</html>


